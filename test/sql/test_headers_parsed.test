# name: test/sql/test_headers_parsed.test
# description: This test triggers the http prefetch mechanism.
# group: [sql]

require httpfs

require parquet

# Needs to be understood what's wrong with this test after changes in both duckdb & duckdb-httpfs
mode skip

statement ok
SET httpfs_client_implementation='curl';

statement ok
CALL enable_logging('HTTP');

query II
select * from 'https://github.com/duckdb/duckdb-data/releases/download/v1.0/job_role_type.parquet' order by all;
----
1	actor
2	actress
3	producer
4	writer
5	cinematographer
6	composer
7	costume designer
8	director
9	editor
10	miscellaneous crew
11	production designer
12	guest

query I
select response.status from duckdb_logs_parsed('HTTP') order by all;
----
OK_200
PartialContent_206

# response status is either
# HTTP/2 200
# HTTP/2 206
# OR
# HTTP/1.1 200 OK
# HTTP/1.1 206 Partial Content
# depending on OS and CA (I think)
query I
select response.headers['__RESPONSE_STATUS__'] LIKE 'HTTP%20%' from duckdb_logs_parsed('HTTP') order by all;
----
true
true
